<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pelican>

<configuration version="1.0">

  <pipeline>

    <clients>
      <K7DataClient>
        <server host="127.0.0.1" port="2000"/>
        <data type="SpectrumDataSetStokes" adapter="K7DataAdapter"/>
      </K7DataClient>
    </clients>

    <adapters>
      <K7DataAdapter>
        <packet channels="1024"/>
        <blob channels="1024"/>
        <start channel="0"/>
      </K7DataAdapter>
    </adapters>

    <pipelineConfig>
      <K7Pipeline>
        <history value="1120"/>
        <events min="2" max="100000"/>
      </K7Pipeline>
    </pipelineConfig>

    <modules>

      <!--RFI_Clipper active="true" channelRejectionRMS="5.0" spectrumRejectionRMS="6.0">
        <zeroDMing active="true"/>
        <BandPassData file="/usr/local/src/pelican-lofar/alfa.bp"/>
        <Band matching="true"/>
        <History maximum="10000"/>
      </RFI_Clipper-->

      <StokesIntegrator>
        <integrateTimeBins value="1"/>
        <integrateFrequencyChannels value="1"/>
      </StokesIntegrator>

      <!--DedispersionModule>
        <timeBinsPerBufferPow2 value="15"/>
        <sampleTime seconds="0.00008192"/>
        <channelBandwidth MHz="-0.390625"/>
        <dedispersionSamples value="2560"/>
        <dedispersionStepSize value="1.0"/>
        <dedispersionMinimum value="0.0"/>
        <numberOfBuffers value="5"/>
      </DedispersionModule-->

      <!--DedispersionAnalyser>
        <detectionThreshold in_sigma="10.0"/>
        <power2ForBinning value="6"/>
      </DedispersionAnalyser-->

    </modules>

    <output>

      <dataStreams>
        <!--stream name="DedispersionDataAnalysis" listeners="DedispersionDataAnalysisOutput"/>
        <stream name="SignalFoundSpectrum" listeners="SigprocStokesWriter"/-->
        <stream name="SpectrumDataSetStokes" listeners="SigprocStokesWriter"/>
      </dataStreams>

      <streamers>

        <!--DedispersionDataAnalysisOutput active="false">
          <file name="/usr/local/src/pelican-lofar/K7_dm"/>
        </DedispersionDataAnalysisOutput-->

        <SigprocStokesWriter active="true" writeHeader="true">
          <subbandsPerPacket value="1024"/>
          <totalComplexSubbands value="512"/>
          <clock value="400"/>
          <integrateTimeBins value="32"/>
          <integrateFrequencyChannels value="1"/>
          <outputChannelsPerSubband value="1"/>
          <nRawPolarisations value="2"/>
          <dataBits value="32"/>
          <samplesPerPacket value="1"/>
          <tsamp value="0.00008192"/>
          <params nPolsToWrite="1"/>
          <dataBitSize value="16"/>
          <outputChannelsPerSubband value="1024"/>
          <udpPacketsPerIteration value="128"/>
          <foff value="-0.390625"/>
          <TelescopeID value="64"/>
          <MachineID value="13"/>
          <file filepath="/home/serylak/work/git/pelican-katburst/K7_fb"/>
        </SigprocStokesWriter>

      </streamers>

    </output>

  </pipeline>

</configuration>
